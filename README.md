Курсовая работа по дисциплине "Проектирование высоконагруженных систем"

*Малютин Илья, осень 2025*


## Содержание
* [**1. Тема, аудитория, функционал**](#1-тема-аудитория-функционал)

* [**2. Расчёт нагрузки**](#2-расчёт-нагрузки)

## 1. Тема, аудитория, функционал

### Тема

Google — поисковый сервис (web search) с сопутствующими продуктами: картинки, видео, карты, новости, локальные и коммерческие результаты, а также современные AI‑обзоры (AI Overviews).

### Аудитория

#### Глобальные оценки и ключевые показатели (используются в расчётах)

* Поисковых запросов в сутки: **~16.4 млрд запросов/сутки** (оценка).
* Глобальная доля рынка поиска: **~89–90%**.
* Размер индекса (оценка по публичным данным и свидетельствам): **порядка сотен миллиардов документов** (вплоть до ~400 млрд документов); индекс занимает порядка **десятков—сотен петабайт** хранилища.
* Средняя длина поискового запроса (в словах/символах): **~1.9 слова / ~8–9 символов** (тренд в сторону удлинения запросов из‑за AI‑поиска).
* Доля "zero‑click" (поиск без перехода на внешний сайт): **порядка 58–60%** в исследовании 2024–2025 гг.

> Примечание: выше — агрегированные публичные оценки, использованные в расчётах ниже.

### Функционал

Ключевой функционал поискового сервиса Google (обобщённо):

* Поиск веб‑страниц (SERP)
* Автодополнение (autocomplete)
* Картинки, видео, карты, новости
* Knowledge Graph / панели знаний
* Featured snippets и AI‑обзоры (AI Overviews)
* Рекламные показы и аукцион (Ad Auction)
* Персонализация результатов (history, location)
* Голосовой поиск (Assistant)
* Интерфейсы API и мобильные SDK

Ключевое продуктовое решение: предоставить релевантный ответ пользователю максимально быстро (низкая задержка) и масштабируемо; монетизация — рекламные показы/аукционы в реальном времени.

## 2. Расчёт нагрузки

### Допущения

* Используются публично доступные оценки (см. список источников в конце).
* Поисковых запросов в сутки: $S_{day} = 16.4\cdot 10^{9}$ (задано).
* Пиковая нагрузка в 3 раза больше средней (аналогично примеру).
* Средний размер сохраняемой записи о поисковом запросе (query log + метаданные): $q_{bytes} = 500$ байт (включая хеш userID, timestamp, гео, параметры запроса, простой результат‑ид).
* Средний размер ответа SERP (payload, HTML+JSON+snippet): $r_{bytes} = 50\,000$ байт (50 КБ) — включает тексты, ссылки, миниатюры.
* Размер профильной информации пользователя (аватар 400×400 jpeg + prefs): $profile \approx 100$ КБ.
* Индекс поисковых документов: используем оценку **400 млрд документов** и индексный объём **~100\,000\,000 ГБ** (порядок сотен петабайт) для приближённых расчетов.
* Средняя длина запроса: 9 символов (используется при оценке объёма текстовой части).
* Частота показов рекламы: предполагаем, что объявления показываются в **30%** запросов (параметр для расчёта дополнительной нагрузки аукциона).
* Recrawl (перерасканирование) индекса: считаем, что в месяц обновляется 1% документов (консервативно).


### 2.1. Расчёт среднего размера хранилища на одного пользователя в месяц

* Профиль (аватар + prefs):

$$100\,\text{КБ}$$

* История запросов (в среднем запросов в месяц на пользователя):

Сначала оценим среднее число уникальных пользователeй, активно использующих поиск. Если принять, что средний пользователь делает ~3.3 запроса в сутки (вытекает из соотношения $S_{day}$ и числа активных пользователей), то в месяц:

Пусть число реальных пользователей, использующих поиск, $U\approx 5\cdot10^{9}$ (оценка). Тогда среднее число запросов в месяц на пользователя:

$$Q_{month} = \frac{S_{day}\cdot 30}{U} \approx \frac{16.4\cdot10^{9}\cdot 30}{5\cdot10^{9}} \approx 98.4 \; \text{запросов/мес}$$

Объём хранения истории запросов на одного пользователя в месяц:

$$98.4 \cdot 500 \approx 49\,200 \;\text{байт} \approx 48 \;\text{КБ}$$

* Итого — средний профиль + история в месяц на пользователя:

$$100\,\text{КБ} + 48\,\text{КБ} \approx 148\,\text{КБ}$$

(Округлим до **~150 КБ/пользователь в месяц** для простоты.)


### 2.2. Расчёт общего объёма логов и трафика

* Логи запросов (query logs):

$$\text{Дневной объём (байт)} = S_{day} \cdot q_{bytes} = 16.4\cdot10^{9} \cdot 500 \approx 8.2\cdot10^{12} \;\text{байт}$$

что соответствует

$$8.2\,\text{ТБ/сутки}$$

и за месяц:

$$8.2 \cdot 30 \approx 246\,\text{ТБ/мес}$$

* Трафик выдачи SERP (передача результатов пользователям):

$$\text{Дневной объём выдачи (байт)} = S_{day} \cdot r_{bytes} = 16.4\cdot10^{9} \cdot 50\,000 \approx 8.2\cdot10^{14} \;\text{байт}$$

$$\approx 820\,\text{ТБ/сутки}$$

* Средняя пропускная способность (выдача результатов) в бит/с:

$$\text{Avg Gbps} = \frac{820\,\text{ТБ} \cdot 8}{86400 \;\text{с}} \approx 76 \;\text{Гбит/с}$$

Пиковая (3×):

$$\approx 228 \;\text{Гбит/с}$$

* Итого: доставка SERP — доминирующая часть пользовательского трафика (в десятках—сотнях Гбит/с).


### 2.3. Хранилище индекса и документов

* По оценке (публичные данные и свидетельства): индекс порядка **400\cdot10^{9}** документов и объём индекса порядка **100\,000\,000 ГБ** (~100\,000 ТБ = 100 ПБ). Тогда средний объём индексной записи на документ:

$$\frac{100\,000\,\text{ТБ}}{400\cdot10^{9}} = 0.00025\,\text{ТБ/документ} = 250\,\text{КБ/документ}$$

(Это усреднённая оценка, фактическая структура индекса гораздо сложнее: инвертированные списки, термин‑частоты, снапшоты страниц, миниатюры, языковые версии и пр.)

* Recrawl (1%/месяц) означает переработку:

$$400\cdot10^{9} \cdot 0.01 = 4\cdot10^{9} \;\text{документов/месяц} \approx 133\cdot10^{6} \;\text{документов/сутки}$$

Если средний скачиваемый объём страницы (при краулинге) взять за $p_{bytes}=50\,000$ байт (50 КБ), то трафик краулинга в сутки:

$$133\cdot10^{6} \cdot 50\,000 \approx 6.65\cdot10^{12} \;\text{байт} \approx 6.65\,\text{ТБ/сутки}$$

(Это трафик с краулеров к «внешнему» вебу — не к пользователям.)


### 2.4. RPS (Requests per second)

* Средний RPS поисковых запросов:

$$\text{RPS}_{avg} = \frac{S_{day}}{24\cdot3600} = \frac{16.4\cdot10^{9}}{86400} \approx 189\,815 \;\text{запросов/с}$$

* Пиковый (3×):

$$\text{RPS}_{peak} \approx 569\,445 \;\text{запросов/с}$$

* Дополнительно (оценочно):

  * Клики по результатам (CTR): если допустить, что **~40%** поисков приводят к клику на результат (вариативно — сейчас наблюдается высокий уровень zero‑click), то кликов в секунду:

  $$0.4\cdot 189\,815 \approx 75\,926\;\text{кликов/с}$$

  * Показы рекламных аукционов: при показе рекламы в 30% запросов:

  $$0.3\cdot 189\,815 \approx 56\,945\;\text{аукционов/с}$$

  * Автодополнение (keystroke requests): если средний пользователь делает 3.3 запроса в сутки и на каждом запросе в среднем 5 нажатий клавиш, то keystroke‑запросов будет порядка 5× больше базового RPS (оценочно). Это требует отдельного кэширования и CDN.


### 2.5. Продуктовые метрики (сводно)

| Метрика                                | Значение (приближенно)   |
|----------------------------------------|--------------------------|
| Поисковых запросов/сутки (S_day)       | 16.4 млрд                |
| Средний RPS                            | ~189,815 RPS             |
| Пиковый RPS (3×)                       | ~569,445 RPS             |
| Средний объём логов/сутки              | ~8.2 ТБ                  |
| Объём выдачи SERP/сутки                | ~820 ТБ                  |
| Индекс (оценка)                        | ~400 млрд документов, ~100 ПБ |
| Средний объём/пользователь/мес         | ~150 КБ                  |


### Выводы (кратко)

1. Поисковая служба Google — это крайне высоконагруженная система с сотнями тысяч RPS в сутки и сотнями петабайт индекса.
2. Основные нагрузки приходятся на выдачу SERP (трафик) и на хранение/поддержку индекса; логи запросов по объёму заметны, но малы по сравнению с индексом.
3. Peak‑нагрузки (пиковые RPS и пиковая пропускная способность) определяют проектирование front‑end кластеров, кэширования и CDN.
4. Дополнительная оперативная нагрузка генерируется рекламными аукционами (десятки тысяч аукционов в секунду) и автодополнением.


## Источники (использованные публичные оценки и статьи)

1. Оценка числа поисковых запросов в сутки и ежегодного объёма — агрегированные публикации/статистические обзоры (см. публичные источники 2024–2025).
2. Доля рынка поиска — StatCounter (глобальная доля Google ~89–90%).
3. Оценки размера индекса — публичные свидетельства и анализы (оценки порядка сотен миллиардов документов, сотни петабайт).
4. Исследования по "zero‑click" — SparkToro / исследовательские отчёты 2024–2025.